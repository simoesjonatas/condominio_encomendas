{% extends "base.html" %}

{% block title %}Encomendas Pendentes{% endblock %}

{% block content %}

<h3 class="mb-3">
    <i class="bi bi-stack"></i> Encomendas Pendentes
</h3>

<div class="d-flex justify-content-end mb-3">
    <a href="{% url 'selecao_impressao' %}" class="btn btn-warning">
        <i class="bi bi-printer-fill"></i> Impressão em Massa
    </a>
</div>


<form method="get" class="card p-3 mb-4 shadow-sm">

    <div class="row g-3">

        <div class="col-md-3">
            <label class="form-label">Bloco</label>
            <select name="bloco" class="form-select">
                <option value="">Todos</option>
                {% for b in blocos %}
                    <option value="{{ b.id }}" {% if f_bloco == b.id|stringformat:'s' %}selected{% endif %}>
                        {{ b.nome }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-3">
            <label class="form-label">Apartamento</label>
            <select name="apto" class="form-select">
                <option value="">Todos</option>
                {% for a in apartamentos %}
                    <option value="{{ a.id }}" {% if f_apto == a.id|stringformat:'s' %}selected{% endif %}>
                        {{ a.bloco.nome }} - {{ a.numero }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-3">
            <label class="form-label">Data de Recebimento</label>
            <input type="date" name="data" class="form-control" value="{{ f_data }}">
        </div>

        <div class="col-md-3">
            <label class="form-label">Buscar</label>
            <input
                type="text"
                name="busca"
                class="form-control"
                placeholder="Nome do morador ou descrição"
                value="{{ f_busca }}"
            >
        </div>

    </div>

    <div class="d-flex justify-content-between mt-3">
        <button class="btn btn-primary">
            <i class="bi bi-search"></i> Filtrar
        </button>

        

        {% if encomendas %}
        <a href="{% url 'imprimir_encomendas' %}?{{ request.GET.urlencode }}"
           class="btn btn-success">
            <i class="bi bi-printer"></i> Imprimir Etiquetas
        </a>
        {% endif %}
    </div>

</form>


{% if encomendas %}

    <div class="list-group">

        {% for e in encomendas %}
            <div class="list-group-item list-group-item-action mb-2 shadow-sm rounded">

                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-1 fw-bold">
                        Bloco {{ e.apartamento.bloco.nome }} · Apto {{ e.apartamento.numero }}
                    </h5>

                    <span class="badge bg-primary">
                        #{{ e.sequencial_do_dia }}
                    </span>
                </div>

                <p class="mb-1 text-muted">
                    Morador: <strong>{{ e.morador.nome }}</strong><br>
                    Recebido em: {{ e.data_recebimento }}
                </p>

                {% if e.descricao %}
                    <p class="text-muted small">Pacote: {{ e.descricao }}</p>
                {% endif %}

                <div class="mt-3 d-flex gap-2">
                    <a href="{% url 'entregar_encomenda' e.pk %}" class="btn btn-success w-100">
                        <i class="bi bi-pencil"></i> Registrar Entrega
                    </a>

                    <a href="{% url 'detalhes_encomenda' e.pk %}" class="btn btn-outline-primary btn-sm w-100">
                        <i class="bi bi-search"></i> Detalhes
                    </a>

                </div>

            </div>
        {% endfor %}

    </div>

{% else %}

    <div class="alert alert-info">
        Nenhuma encomenda pendente no momento.
    </div>

{% endif %}

{% endblock %}
